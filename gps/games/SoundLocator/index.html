<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>مینی‌گیم مکان‌یابی صدا با اسلایدر</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Tahoma', sans-serif; }

  /* === استایل اسلایدرها === */
  .slider-blue::-webkit-slider-thumb,
  .slider-green::-webkit-slider-thumb,
  .slider-purple::-webkit-slider-thumb,
  .slider-red::-webkit-slider-thumb {
    appearance: none;
    height: 22px;
    width: 22px;
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid white;
    transition: all 0.2s ease;
  }
  .slider-blue::-webkit-slider-thumb { background: linear-gradient(135deg,#3b82f6,#1d4ed8); box-shadow: 0 4px 10px rgba(59,130,246,.4); }
  .slider-green::-webkit-slider-thumb { background: linear-gradient(135deg,#10b981,#047857); box-shadow: 0 4px 10px rgba(16,185,129,.4); }
  .slider-purple::-webkit-slider-thumb { background: linear-gradient(135deg,#8b5cf6,#6d28d9); box-shadow: 0 4px 10px rgba(139,92,246,.4); }
  .slider-red::-webkit-slider-thumb { background: linear-gradient(135deg,#ef4444,#dc2626); box-shadow: 0 4px 10px rgba(239,68,68,.4); }

  input[type="range"]::-webkit-slider-track {
    height: 10px;
    border-radius: 6px;
  }

  /* ساعت زیباتر */
  #clock {
    border-radius: 50%;
    background: radial-gradient(circle at center, #ffffff 60%, #f0f4ff 100%);
    box-shadow: inset 0 0 15px rgba(0,0,0,0.05), 0 8px 16px rgba(0,0,0,0.1);
    transition: transform .3s ease;
  }
  #clock:hover { transform: scale(1.05); }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-cyan-50 min-h-screen p-2 sm:p-4 lg:p-6">
<div class="container mx-auto max-w-7xl">
<div class="grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6 min-h-screen xl:min-h-0">

  <!-- سمت چپ: ساعت -->
  <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-xl border border-white/30 p-6 flex flex-col items-center order-2 xl:order-1 hover:shadow-2xl transition-all duration-300">
    <div class="p-4 rounded-2xl mb-4">
      <canvas id="clock" width="300" height="300" class="w-full max-w-[250px] sm:max-w-[300px] h-auto"></canvas>
    </div>
    <button id="startBtn" class="px-8 py-4 bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white rounded-2xl hover:from-blue-600 hover:via-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl mb-6 font-semibold text-lg transform hover:scale-105 active:scale-95">✨ پخش</button>
    <div class="mt-4 sm:mt-6 space-y-3 w-full max-w-sm">
      <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 shadow-sm">
        <span class="text-blue-700 font-medium">Lap 1:</span> <span id="lap1" class="font-mono text-blue-900 font-bold">-</span>
      </div>
      <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border border-green-100 shadow-sm">
        <span class="text-green-700 font-medium">Lap 2:</span> <span id="lap2" class="font-mono text-green-900 font-bold">-</span>
      </div>
      <div class="p-4 bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl border border-purple-100 shadow-sm">
        <span class="text-purple-700 font-medium">Lap 3:</span> <span id="lap3" class="font-mono text-purple-900 font-bold">-</span>
      </div>
    </div>
    <div id="status" class="mt-6 text-center text-gray-600 text-sm sm:text-base px-4 py-3 bg-gray-50/80 rounded-xl border border-gray-100">برای شروع روی پخش کلیک کنید و زمان ها را با کلیک روی ساعت ثبت کنید</div>
  </div>

  <!-- سمت راست: نقشه و اسلایدر -->
  <div class="bg-white/90 backdrop-blur-md rounded-3xl shadow-xl border border-white/30 p-6 flex flex-col items-center order-1 xl:order-2 hover:shadow-2xl transition-all duration-300">
    <div class="bg-gradient-to-br from-gray-50 to-blue-50 p-4 rounded-2xl mb-4 shadow-inner">
      <canvas id="map" width="400" height="400" class="w-full max-w-[320px] sm:max-w-[400px] h-auto rounded-xl shadow-md"></canvas>
    </div>

    <!-- 📍 مختصات بالای اسلایدرها -->
    <div id="result" class="mb-6 font-mono text-sm sm:text-base text-gray-700 text-center bg-gradient-to-r from-gray-50 to-blue-50 px-4 py-3 rounded-2xl border border-gray-200 min-h-[3rem] flex items-center justify-center shadow-inner font-medium">📍 مختصات موس</div>

    <div class="space-y-4 w-full max-w-md">
      <div class="space-y-3 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 shadow-sm">
        <label class="text-sm sm:text-base text-blue-800 font-semibold flex justify-between items-center">
          <span>🔵 شعاع ۱</span>
          <span id="r1Val" class="font-mono text-blue-600 bg-white px-2 py-1 rounded-lg text-sm font-bold">500</span>
        </label>
        <input type="range" id="r1" min="500" max="3000" step="10" value="500" class="w-full h-3 bg-blue-100 rounded-full appearance-none cursor-pointer slider-blue">
      </div>
      <div class="space-y-3 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl border border-green-100 shadow-sm">
        <label class="text-sm sm:text-base text-green-800 font-semibold flex justify-between items-center">
          <span>🟢 شعاع ۲</span>
          <span id="r2Val" class="font-mono text-green-600 bg-white px-2 py-1 rounded-lg text-sm font-bold">500</span>
        </label>
        <input type="range" id="r2" min="500" max="3000" step="10" value="500" class="w-full h-3 bg-green-100 rounded-full appearance-none cursor-pointer slider-green">
      </div>
      <div class="space-y-3 p-4 bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl border border-purple-100 shadow-sm">
        <label class="text-sm sm:text-base text-purple-800 font-semibold flex justify-between items-center">
          <span>🟣 شعاع ۳</span>
          <span id="r3Val" class="font-mono text-purple-600 bg-white px-2 py-1 rounded-lg text-sm font-bold">500</span>
        </label>
        <input type="range" id="r3" min="500" max="3000" step="10" value="500" class="w-full h-3 bg-purple-100 rounded-full appearance-none cursor-pointer slider-purple">
      </div>
      <div class="space-y-3 p-4 bg-gradient-to-r from-red-50 to-pink-50 rounded-2xl border border-red-100 shadow-sm">
        <label class="text-sm sm:text-base text-red-800 font-semibold flex justify-between items-center">
          <span>⚙️ تنظیم کلی</span>
          <span id="rAllVal" class="font-mono text-red-600 bg-white px-2 py-1 rounded-lg text-sm font-bold">0</span>
        </label>
        <input type="range" id="rAll" min="-500" max="500" step="10" value="0" class="w-full h-3 bg-red-100 rounded-full appearance-none cursor-pointer slider-red">
      </div>
    </div>
  </div>

</div>

<script>
/* === ساعت === */
const clockCanvas = document.getElementById("clock");
const ctx = clockCanvas.getContext("2d");
let angle = 0, timer = null, startTime = null, lapCount = 0;
const laps = [];
let gameRunning = false;

function drawClock() {
  ctx.clearRect(0, 0, 300, 300);
  ctx.beginPath();
  ctx.arc(150, 150, 140, 0, Math.PI * 2);
  ctx.strokeStyle = "#4b5563";
  ctx.lineWidth = 6;
  ctx.stroke();

  ctx.fillStyle = "#111827";
  ctx.font = "20px Tahoma";
  ctx.textAlign = "center";
  ["12", "3", "6", "9"].forEach((t, i) => {
    const pos = [[150, 40], [260, 155], [150, 270], [40, 155]][i];
    ctx.fillText(t, pos[0], pos[1]);
  });

  ctx.beginPath();
  ctx.moveTo(150, 150);
  const handX = 150 + 95 * Math.cos(angle - Math.PI / 2);
  const handY = 150 + 95 * Math.sin(angle - Math.PI / 2);
  ctx.lineTo(handX, handY);
  ctx.strokeStyle = '#ef4444';
  ctx.lineWidth = 5;
  ctx.lineCap = "round";
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(150, 150, 7, 0, Math.PI * 2);
  ctx.fillStyle = '#ef4444';
  ctx.fill();
}

function startClock() {
  if (gameRunning) {
    clearInterval(timer);
    gameRunning = false;
    document.getElementById("startBtn").textContent = "✨ پخش";
    document.getElementById("startBtn").className = "px-8 py-4 bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white rounded-2xl hover:from-blue-600 hover:via-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl mb-6 font-semibold text-lg transform hover:scale-105 active:scale-95";
    document.getElementById("status").textContent = "سساعت متوقف شد. برای ادامه روی پخش کلیک کنید.";
    return;
  }

  gameRunning = true;
  if (!startTime) {
    angle = 0;
    startTime = Date.now();
    lapCount = 0;
    laps.length = 0;
    ["lap1", "lap2", "lap3"].forEach(id => document.getElementById(id).textContent = "-");
  }
  document.getElementById("status").textContent = "ساعت شروع شد! با کلیک روی ساعت زمان ها را ثبت کنید";
  document.getElementById("startBtn").textContent = "⏸️ توقف";
  document.getElementById("startBtn").className = "px-8 py-4 bg-gradient-to-r from-red-500 via-red-600 to-pink-600 text-white rounded-2xl hover:from-red-600 hover:via-red-700 hover:to-pink-700 transition-all duration-300 shadow-lg hover:shadow-xl mb-6 font-semibold text-lg transform hover:scale-105 active:scale-95";
  if (timer) clearInterval(timer);
  timer = setInterval(() => {
    const elapsed = (Date.now() - startTime) / 1000;
    angle = (elapsed / 60) * 2 * Math.PI;
    drawClock();
  }, 50);

  [2000, 4000, 6000].forEach((t, i) => {
    setTimeout(() => { playBeep(); }, t);
  });

  setTimeout(() => {
    gameRunning = false;
    clearInterval(timer);
    drawMap();
    document.getElementById("status").textContent = "بازی تمام شد!";
    document.getElementById("startBtn").textContent = "✨ پخش";
    document.getElementById("startBtn").className = "px-8 py-4 bg-gradient-to-r from-blue-500 via-blue-600 to-indigo-600 text-white rounded-2xl hover:from-blue-600 hover:via-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl mb-6 font-semibold text-lg transform hover:scale-105 active:scale-95";
  }, 7000);
}

function playBeep() {
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.frequency.value = 800;
  oscillator.type = 'square';
  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.3);
}

/* === نقشه === */
const mapCanvas = document.getElementById("map");
const mctx = mapCanvas.getContext("2d");

const me = { x: 200, y: 200 };
const sources = [
  { x: 200, y: 260, color: '#3b82f6' },
  { x: 320, y: 200, color: '#10b981' },
  { x: 80, y: 66, color: '#8b5cf6' } // مختصات جدید نقطه ۳
];

const r1 = document.getElementById("r1");
const r2 = document.getElementById("r2");
const r3 = document.getElementById("r3");
const rAll = document.getElementById("rAll");
const r1Val = document.getElementById("r1Val");
const r2Val = document.getElementById("r2Val");
const r3Val = document.getElementById("r3Val");
const rAllVal = document.getElementById("rAllVal");

const scaleFactor = 0.1;

function drawMap(showRed = false) {
  mctx.clearRect(0, 0, 400, 400);
  mctx.save();
  mctx.translate(0, 400);
  mctx.scale(1, -1);

  const masterOffset = parseInt(rAll.value);
  const radii = [
    parseInt(r1.value) * scaleFactor + masterOffset * scaleFactor,
    parseInt(r2.value) * scaleFactor + masterOffset * scaleFactor,
    parseInt(r3.value) * scaleFactor + masterOffset * scaleFactor
  ];

  sources.forEach((s, i) => {
    mctx.beginPath();
    mctx.arc(s.x, s.y, radii[i], 0, Math.PI * 2);
    mctx.strokeStyle = s.color;
    mctx.lineWidth = 2;
    mctx.stroke();
  });

  sources.forEach((s, i) => {
    mctx.beginPath();
    mctx.arc(s.x, s.y, 8, 0, Math.PI * 2);
    mctx.fillStyle = s.color;
    mctx.fill();
    mctx.save();
    mctx.scale(1, -1);
    mctx.fillStyle = 'white';
    mctx.font = '12px Tahoma';
    mctx.textAlign = 'center';
    mctx.fillText((i + 1).toString(), s.x, -s.y + 4);
    mctx.restore();
  });

  const intersect = checkIntersection(radii);


  mctx.restore();
}

function checkIntersection(radii) {
  let count = 0;
  sources.forEach((s, i) => {
    const distance = Math.sqrt(Math.pow(me.x - s.x, 2) + Math.pow(me.y - s.y, 2));
    if (Math.abs(distance - radii[i]) < 50) count++;
  });
  return count >= 3;
}

[r1, r2, r3, rAll].forEach(r => r.oninput = () => {
  r1Val.textContent = r1.value;
  r2Val.textContent = r2.value;
  r3Val.textContent = r3.value;
  rAllVal.textContent = rAll.value;
  drawMap();
});

mapCanvas.addEventListener("mousemove", (event) => {
  if (!gameRunning) {
    const rect = mapCanvas.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = 400 - (event.clientY - rect.top);
    const realX = (x / scaleFactor).toFixed(0);
    const realY = (y / scaleFactor).toFixed(0);
    document.getElementById("result").textContent = `X: ${realX}, Y: ${realY}`;
  }
});

clockCanvas.addEventListener("click", () => {
  if (!gameRunning || lapCount >= 3) return;
  const elapsed = (Date.now() - startTime) / 1000;
  lapCount++;
  laps.push(elapsed);
  document.getElementById("lap" + lapCount).textContent = elapsed.toFixed(2) + "s";
  if (lapCount < 3) document.getElementById("status").textContent = `لپ ${lapCount} ثبت شد.`;
});

document.getElementById("startBtn").addEventListener("click", () => {
  startClock();
  drawClock();
});

drawClock();
drawMap();
</script>
</body>
</html>