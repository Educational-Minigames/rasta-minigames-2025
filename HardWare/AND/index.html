<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AND Gate Mini-Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    @font-face {
      font-family: 'Vazir';
      src: url('https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.woff') format('woff');
    }
    canvas {
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      background: #ffffff;
      width: 100%;
      max-width: 320px;
    }
    .min-h-screen { min-height: 100vh; }
    .bg-gradient-to-br { background-image: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
    .from-cyan-100 { --tw-gradient-from: #cffafe; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(207 estacion250, 254, 0)); }
    .to-cyan-200 { --tw-gradient-to: #a5f3fc; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .p-4 { padding: 1rem; }
    .max-w-6xl { max-width: 72rem; }
    .w-full { width: 100%; }
    .gap-4 { gap: 1rem; }
    .flex-1 { flex: 1 1 0%; }
    @media (min-width: 768px) {
      .md\:flex-row { flex-direction: row; }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-cyan-100 to-cyan-200 flex items-center justify-center p-4">
  <div class="flex flex-col md:flex-row gap-4 max-w-6xl w-full items-center justify-center">
    <div id="schematic" class="flex-1 flex justify-center"></div>
    <div id="truth-table" class="flex-1 flex justify-center"></div>
    <div id="circuit" class="flex-1 flex justify-center"></div>
  </div>

<script>
let switchState = 0;
let table = [
  { input1: 0, input2: 0, output: 0 },
  { input1: 0, input2: 1, output: 0 },
  { input1: 1, input2: 0, output: 0 },
  { input1: 1, input2: 1, output: 1 }
];
let results = [false, false, false, false];
let checkButtonColor;

function setupSchematic() {
  let sketch = function(p) {
    let img;

    p.preload = function() {
      img = p.loadImage('AND.png');
    };

    p.setup = function() {
      p.createCanvas(320, 450);
      p.textAlign(p.CENTER, p.CENTER);
      p.textSize(16);
      p.textFont('Vazir');
    };

    p.draw = function() {
      p.background(255);
      p.fill(255);
      p.stroke(0);
      p.strokeWeight(1);
      p.rect(20, 30, 280, 390, 20);
      p.textSize(22);
      p.fill(0);
      p.text("شماتیک گیت AND", 160, 60);
      
      if (img) {
        p.image(img, 80, 150, 160, 160);
      } else {
        p.textSize(16);
        p.text("در حال بارگذاری تصویر...", 160, 220);
      }
    };

    p.mousePressed = function() {
      if (p.mouseX > 160 && p.mouseX < 190 && p.mouseY > 200 && p.mouseY < 240) {
        switchState = 1 - switchState;
      }
    };
  };
  new p5(sketch, 'schematic');
}

function setupTruthTable() {
  let sketch = function(p) {
    p.setup = function() {
      p.createCanvas(320, 450);
      p.textAlign(p.CENTER, p.CENTER);
      p.textSize(16);
      p.textFont('Vazir');
      checkButtonColor = p.color(200, 200, 200);
    };

    p.draw = function() {
      p.background(255);
      p.fill(255);
      p.rect(20, 30, 280, 390, 20);
      p.textSize(22);
      p.fill(0);
      p.text("جدول درستی گیت AND", 160, 50);
      let startX = 80;
      let startY = 100;

      p.textSize(18);
      p.text("ورودی 1", startX - 25, startY - 20);
      p.text("ورودی 2", startX + 40, startY - 20);
      p.text("خروجی", startX + 100, startY - 20);
      p.text("نتیجه", startX + 170, startY - 20);

      for (let i = 0; i < table.length; i++) {
        // Input 1
        p.fill(table[i].input1 ? p.color(50, 205, 50) : p.color(255, 99, 71));
        p.rect(startX - 40, startY + i * 60, 40, 40, 10);
        p.fill(255);
        p.textSize(16);
        p.text(table[i].input1, startX - 20, startY + i * 60 + 20);

        // Input 2
        p.fill(table[i].input2 ? p.color(50, 205, 50) : p.color(255, 99, 71));
        p.rect(startX + 20, startY + i * 60, 40, 40, 10);
        p.fill(255);
        p.text(table[i].input2, startX + 40, startY + i * 60 + 20);

        // Output
        p.fill(table[i].output ? p.color(50, 205, 50) : p.color(255, 99, 71));
        p.rect(startX + 80, startY + i * 60, 40, 40, 10);
        p.fill(255);
        p.text(table[i].output, startX + 100, startY + i * 60 + 20);

        // Result
        p.fill(results[i] ? p.color(50, 205, 50) : p.color(255, 99, 71));
        p.textSize(20);
        p.text(results[i] ? "✅" : "❌", startX + 160, startY + i * 60 + 20);
      }

      p.fill(checkButtonColor);
      p.rect(startX + 20, 340, 120, 50, 15);
      p.fill(255);
      p.textSize(18);
      p.text("بررسی", startX + 80, 365);
    };

    p.mousePressed = function() {
      let startX = 80;
      let startY = 100;
      for (let i = 0; i < table.length; i++) {
        // Input 1
        if (p.mouseX > startX - 40 && p.mouseX < startX && p.mouseY > startY + i * 60 && p.mouseY < startY + i * 60 + 40) {
          table[i].input1 = 1 - table[i].input1;
        }
        // Input 2
        if (p.mouseX > startX + 20 && p.mouseX < startX + 60 && p.mouseY > startY + i * 60 && p.mouseY < startY + i * 60 + 40) {
          table[i].input2 = 1 - table[i].input2;
        }
        // Output
        if (p.mouseX > startX + 80 && p.mouseX < startX + 120 && p.mouseY > startY + i * 60 && p.mouseY < startY + i * 60 + 40) {
          table[i].output = 1 - table[i].output;
        }
      }

      if (p.mouseX > startX + 20 && p.mouseX < startX + 140 && p.mouseY > 340 && p.mouseY < 390) {
        for (let i = 0; i < table.length; i++) {
          let expectedOutput = (table[i].input1 === 1 && table[i].input2 === 1) ? 1 : 0;
          results[i] = table[i].output === expectedOutput;
        }
        let isValid = results.every(r => r);
        checkButtonColor = isValid ? p.color(50, 205, 50) : p.color(255, 99, 71);
      }
    };
  };
  new p5(sketch, 'truth-table');
}

function setupCircuit() {
  let sketch = function(p) {
    let switch1On = false;
    let switch2On = false;
    
    p.setup = function() {
      p.createCanvas(320, 450);
      p.textAlign(p.CENTER, p.CENTER);
      p.textSize(16);
      p.textFont('Vazir');
    };

    p.draw = function() {
      p.background(255);
      p.fill(255);
      p.stroke(0);
      p.strokeWeight(1);
      p.rect(20, 30, 280, 390, 20);
      p.textSize(22);
      p.fill(0);
      p.text("مدار تعاملی", 110, 60);
      
      drawCircuit();
      displayStatus();
    };
    
    function drawCircuit() {
      let centerX = 160;
      let centerY = 225;
      let w = 150;
      let h = 90;
      
      p.stroke(0);
      p.strokeWeight(3);
      p.noFill();
      p.line(centerX - w/2, centerY - h/2, centerX + w/2, centerY - h/2);
      p.line(centerX + w/2, centerY - h/2, centerX + w/2, centerY + h/2);
      p.line(centerX + w/2, centerY + h/2, centerX + 45, centerY + h/2);
      p.line(centerX + 15, centerY + h/2, centerX - 15, centerY + h/2);
      p.line(centerX - 45, centerY + h/2, centerX - w/2, centerY + h/2);
      p.line(centerX - w/2, centerY + h/2, centerX - w/2, centerY - h/2);
      
      drawBattery(centerX - w/2, centerY);
      drawResistor(centerX, centerY - h/2);
      drawBulb(centerX + w/2, centerY);
      drawSwitch(centerX - 30, centerY + h/2, switch1On, 1);
      drawSwitch(centerX + 30, centerY + h/2, switch2On, 2);
    }
    
    function drawBattery(x, y) {
      p.push();
      p.translate(x, y);
      p.stroke(0);
      p.strokeWeight(4);
      p.line(-15, 0, 15, 0);
      p.strokeWeight(3);
      p.line(-10, 8, 10, 8);
      p.fill(0);
      p.textAlign(p.CENTER);
      p.textSize(12);
      p.noStroke();
      p.textSize(10);
      p.text('باتری', -30, 3);
      p.pop();
    }
    
    function drawResistor(x, y) {
      p.push();
      p.translate(x, y);
      p.stroke(0);
      p.strokeWeight(3);
      p.noFill();
      p.beginShape();
      p.vertex(-22, 0);
      p.vertex(-15, 0);
      p.vertex(-11, -8);
      p.vertex(-4, 8);
      p.vertex(4, -8);
      p.vertex(11, 8);
      p.vertex(15, 0);
      p.vertex(22, 0);
      p.endShape();
      p.fill(0);
      p.textAlign(p.CENTER);
      p.textSize(10);
      p.noStroke();
      p.text('مقاومت', 0, 20);
      p.text('R', 0, -15);
      p.pop();
    }
    
    function drawBulb(x, y) {
      p.push();
      p.translate(x, y);
      p.stroke(0);
      p.strokeWeight(2);
      if (switch1On && switch2On) {
        p.fill(255, 255, 0);
      } else {
        p.fill(255);
      }
      p.ellipse(0, 0, 30, 30);
      p.stroke(0);
      p.strokeWeight(1);
      if (switch1On && switch2On) {
        p.stroke(255, 150, 0);
        p.strokeWeight(2);
      }
      p.line(-6, -6, 6, 6);
      p.line(-6, 6, 6, -6);
      p.fill(0);
      p.textAlign(p.CENTER);
      p.textSize(10);
      p.noStroke();
      p.text('لامپ', 28, 0);
      p.pop();
    }
    
    function drawSwitch

(x, y, isOn, switchNum) {
      p.push();
      p.translate(x, y);
      p.stroke(0);
      p.strokeWeight(3);
      p.fill(0);
      p.ellipse(-15, 0, 5, 5);
      p.ellipse(15, 0, 5, 5);
      if (isOn) {
        p.stroke(0, 150, 0);
        p.strokeWeight(4);
        p.line(-15, 0, 15, 0);
      } else {
        p.stroke(255, 0, 0);
        p.strokeWeight(3);
        p.line(-15, 0, 10, -12);
      }
      p.fill(0);
      p.textAlign(p.CENTER);
      p.textSize(10);
      p.noStroke();
      p.text(`سوئیچ ${switchNum}`, 0, 20);
      p.text(isOn ? 'بسته' : 'باز', 0, 32);
      p.pop();
    }
    
    function displayStatus() {
      p.textAlign(p.LEFT);
      p.textSize(12);
      p.fill(0);
    }

    p.mousePressed = function() {
      let switch1X = 160 - 30;
      let switch2X = 160 + 30;
      let switchY = 225 + 45;
      let distance1 = p.dist(p.mouseX, p.mouseY, switch1X, switchY);
      let distance2 = p.dist(p.mouseX, p.mouseY, switch2X, switchY);
      
      if (distance1 < 20) {
        switch1On = !switch1On;
      }
      if (distance2 < 20) {
        switch2On = !switch2On;
      }
      switchState = (switch1On && switch2On) ? 1 : 0;
    };
  };
  new p5(sketch, 'circuit');
}

setupSchematic();
setupTruthTable();
setupCircuit();
</script>
</body>
</html>